
const testdata = [
    {
        "adult": false,
        "backdrop_path": "/sy0vo1cmpKqwPRiMUiJ45jyLsX7.jpg",
        "genre_ids": [
            10751,
            35,
            14
        ],
        "id": 8871,
        "original_language": "en",
        "original_title": "How the Grinch Stole Christmas",
        "overview": "The Grinch decides to rob Whoville of Christmas - but a dash of kindness from little Cindy Lou Who and her family may be enough to melt his heart...",
        "popularity": 223.591,
        "poster_path": "/1WZbbPApEivA421gCOluuzMMKCk.jpg",
        "release_date": "2000-11-17",
        "title": "How the Grinch Stole Christmas",
        "video": false,
        "vote_average": 6.7,
        "vote_count": 6785
    },
    {
        "adult": false,
        "backdrop_path": "/7PBXKqTDCsSZb3GATn94DfXoAGx.jpg",
        "genre_ids": [
            28,
            18,
            12
        ],
        "id": 98,
        "original_language": "en",
        "original_title": "Gladiator",
        "overview": "In the year 180, the death of emperor Marcus Aurelius throws the Roman Empire into chaos.  Maximus is one of the Roman army's most capable and trusted generals and a key advisor to the emperor.  As Marcus' devious son Commodus ascends to the throne, Maximus is set to be executed.  He escapes, but is captured by slave traders.  Renamed Spaniard and forced to become a gladiator, Maximus must battle to the death with other men for the amusement of paying audiences.",
        "popularity": 80.995,
        "poster_path": "/ty8TGRuvJLPUmAR1H1nRIsgwvim.jpg",
        "release_date": "2000-05-04",
        "title": "Gladiator",
        "video": false,
        "vote_average": 8.2,
        "vote_count": 17198
    },
    {
        "adult": false,
        "backdrop_path": "/8bOXV3d9aeaXzjUnmV7L2gNYxul.jpg",
        "genre_ids": [
            12,
            16,
            35,
            10751,
            14
        ],
        "id": 11688,
        "original_language": "en",
        "original_title": "The Emperor's New Groove",
        "overview": "Kuzco is a self-centered emperor who summons Pacha from a village and to tell him that his home will be destroyed to make room for Kuzco's new summer home. Kuzco's advisor, Yzma, tries to poison Kuzco and accidentally turns him into a llama, who accidentally ends up in Pacha's village. Pacha offers to help Kuzco if he doesn't destroy his house, and so they form an unlikely partnership.",
        "popularity": 91.194,
        "poster_path": "/wwbgkXQBEKtnyIJapk6gUgWkVw8.jpg",
        "release_date": "2000-12-15",
        "title": "The Emperor's New Groove",
        "video": false,
        "vote_average": 7.5,
        "vote_count": 6181
    },
    {
        "adult": false,
        "backdrop_path": "/bneUTWFAcVCdsb0O5UwZbJd8xqZ.jpg",
        "genre_ids": [
            53,
            18,
            80
        ],
        "id": 1359,
        "original_language": "en",
        "original_title": "American Psycho",
        "overview": "A wealthy New York investment banking executive hides his alternate psychopathic ego from his co-workers and friends as he escalates deeper into his illogical, gratuitous fantasies.",
        "popularity": 53.234,
        "poster_path": "/9uGHEgsiUXjCNq8wdq4r49YL8A1.jpg",
        "release_date": "2000-04-13",
        "title": "American Psycho",
        "video": false,
        "vote_average": 7.4,
        "vote_count": 9977
    },
    {
        "adult": false,
        "backdrop_path": "/m5dA4JZsj78EBTa2D6imWOAebwB.jpg",
        "genre_ids": [
            35
        ],
        "id": 4247,
        "original_language": "en",
        "original_title": "Scary Movie",
        "overview": "A familiar-looking group of teenagers find themselves being stalked by a more-than-vaguely recognizable masked killer! As the victims begin to pile up and the laughs pile on, none of your favorite scary movies escape the razor-sharp satire of this outrageously funny parody!",
        "popularity": 71.206,
        "poster_path": "/lRQiJXETkCnVVurHmglNvMXrZOx.jpg",
        "release_date": "2000-07-07",
        "title": "Scary Movie",
        "video": false,
        "vote_average": 6.4,
        "vote_count": 6474
    },
    {
        "adult": false,
        "backdrop_path": "/q2CtXYjp9IlnfBcPktNkBPsuAEO.jpg",
        "genre_ids": [
            9648,
            53
        ],
        "id": 77,
        "original_language": "en",
        "original_title": "Memento",
        "overview": "Leonard Shelby is tracking down the man who raped and murdered his wife. The difficulty of locating his wife's killer, however, is compounded by the fact that he suffers from a rare, untreatable form of short-term memory loss. Although he can recall details of life before his accident, Leonard cannot remember what happened fifteen minutes ago, where he's going, or why.",
        "popularity": 50.416,
        "poster_path": "/yuNs09hvpHVU1cBTCAk9zxsL2oW.jpg",
        "release_date": "2000-10-11",
        "title": "Memento",
        "video": false,
        "vote_average": 8.2,
        "vote_count": 13896
    },
    {
        "adult": false,
        "backdrop_path": "/jpPBtDJHIXOOYfQcidyvP42pqRL.jpg",
        "genre_ids": [
            18
        ],
        "id": 10867,
        "original_language": "it",
        "original_title": "Malèna",
        "overview": "During WWII, a teenage boy discovering himself becomes love-stricken by Malèna, a sensual woman living in a small, narrow-minded Italian town.",
        "popularity": 63.181,
        "poster_path": "/3OyQTl0IGkbnjDxd3MhztfPE34g.jpg",
        "release_date": "2000-03-16",
        "title": "Malena",
        "video": false,
        "vote_average": 7.4,
        "vote_count": 2049
    },
    {
        "adult": false,
        "backdrop_path": "/c9xSFZQtC4c16Vn5CMOaB1pGk9J.jpg",
        "genre_ids": [
            18,
            36,
            10752,
            28
        ],
        "id": 2024,
        "original_language": "en",
        "original_title": "The Patriot",
        "overview": "After proving himself on the field of battle in the French and Indian War, Benjamin Martin wants nothing more to do with such things, preferring the simple life of a farmer. But when his son Gabriel enlists in the army to defend their new nation, America, against the British, Benjamin reluctantly returns to his old life to protect his son.",
        "popularity": 55.591,
        "poster_path": "/fWZd815QxUCUcrWQZwUkAp9ljG.jpg",
        "release_date": "2000-06-28",
        "title": "The Patriot",
        "video": false,
        "vote_average": 7.2,
        "vote_count": 3605
    },
    {
        "adult": false,
        "backdrop_path": "/xWG7emUlBPhsJ2MyQHqH0poeXwm.jpg",
        "genre_ids": [
            16,
            35,
            10751
        ],
        "id": 7443,
        "original_language": "en",
        "original_title": "Chicken Run",
        "overview": "The creators of Wallace & Gromit bring you an exciting and original story about a group of chickens determined to fly the coop–even if they can’t fly! It’s hardly poultry in motion when Rocky attempts to teach Ginger and her feathered friends to fly…but, with teamwork, determination and a little bit o’ cluck, the fearless flock plots one last attempt in a spectacular bid for freedom.",
        "popularity": 56.822,
        "poster_path": "/oYbVT9e0k2ZSrRhDSCw2Yqshe1n.jpg",
        "release_date": "2000-06-23",
        "title": "Chicken Run",
        "video": false,
        "vote_average": 6.8,
        "vote_count": 4568
    },
    {
        "adult": false,
        "backdrop_path": "/4JOPLgIwDQ1qNI5EHiCF5hPII8Y.jpg",
        "genre_ids": [
            27,
            9648
        ],
        "id": 4234,
        "original_language": "en",
        "original_title": "Scream 3",
        "overview": "While Sidney lives in safely guarded seclusion, bodies begin dropping around the Hollywood set of STAB 3, the latest movie based on the gruesome Woodsboro killings.",
        "popularity": 49.212,
        "poster_path": "/qpH8ToZVlFD1bakL04LkEKodyDI.jpg",
        "release_date": "2000-02-03",
        "title": "Scream 3",
        "video": false,
        "vote_average": 6,
        "vote_count": 3251
    },
    {
        "adult": false,
        "backdrop_path": "/7isarjYDEKZ5t1CgcvbuqEUby8P.jpg",
        "genre_ids": [
            27
        ],
        "id": 9532,
        "original_language": "en",
        "original_title": "Final Destination",
        "overview": "After a teenager has a terrifying vision of him and his friends dying in a plane crash, he prevents the accident only to have Death hunt them down, one by one.",
        "popularity": 42.303,
        "poster_path": "/1mXhlQMnlfvJ2frxTjZSQNnA9Vp.jpg",
        "release_date": "2000-03-17",
        "title": "Final Destination",
        "video": false,
        "vote_average": 6.6,
        "vote_count": 5177
    },
    {
        "adult": false,
        "backdrop_path": "/n74r1dfTqnArIGC8VNU8k0gHf04.jpg",
        "genre_ids": [
            35,
            18,
            10749
        ],
        "id": 22705,
        "original_language": "it",
        "original_title": "Tra(sgre)dire",
        "overview": "While scouting out apartments in London for her Venetian boyfriend, Carla rents an apartment that overlooks the Thames. There she meet the lesbian hyper-horny real estate agent Moira.",
        "popularity": 49.792,
        "poster_path": "/7gqcEgJfTltbLo76nZTl8umgM1Y.jpg",
        "release_date": "2000-01-28",
        "title": "Cheeky",
        "video": false,
        "vote_average": 5.6,
        "vote_count": 226
    },
    {
        "adult": false,
        "backdrop_path": "/laeEtakR2pLKu3CeRwB2lU5Y53X.jpg",
        "genre_ids": [
            10751,
            16
        ],
        "id": 10567,
        "original_language": "en",
        "original_title": "Dinosaur",
        "overview": "An orphaned dinosaur raised by lemurs joins an arduous trek to a sancturary after a meteorite shower destroys his family home.",
        "popularity": 57.613,
        "poster_path": "/rSje3FS7ycJSglowlngjsvDt7vO.jpg",
        "release_date": "2000-05-19",
        "title": "Dinosaur",
        "video": false,
        "vote_average": 6.5,
        "vote_count": 2321
    },
    {
        "adult": false,
        "backdrop_path": "/f0QUyDBMLBhyHI0lp5OwzHPS1R.jpg",
        "genre_ids": [
            18
        ],
        "id": 11978,
        "original_language": "en",
        "original_title": "Men of Honor",
        "overview": "Against formidable odds -- and an old-school diving instructor embittered by the U.S. Navy's new, less prejudicial policies -- Carl Brashear sets his sights on becoming the Navy's first African-American master diver in this uplifting true story. Their relationship starts out on the rocks, but fate ultimately conspires to bring the men together into a setting of mutual respect, triumph and honor.",
        "popularity": 32.84,
        "poster_path": "/wNUAnXV1mzOOfvnVBIYsalkk078.jpg",
        "release_date": "2000-09-13",
        "title": "Men of Honor",
        "video": false,
        "vote_average": 7.5,
        "vote_count": 2097
    },
    {
        "adult": false,
        "backdrop_path": "/ysKahAEPP8h6MInuLjr0xuZOTjh.jpg",
        "genre_ids": [
            80,
            35
        ],
        "id": 107,
        "original_language": "en",
        "original_title": "Snatch",
        "overview": "Unscrupulous boxing promoters, violent bookmakers, a Russian gangster, incompetent amateur robbers and supposedly Jewish jewelers fight to track down a priceless stolen diamond.",
        "popularity": 44.526,
        "poster_path": "/56mOJth6DJ6JhgoE2jtpilVqJO.jpg",
        "release_date": "2000-09-01",
        "title": "Snatch",
        "video": false,
        "vote_average": 7.8,
        "vote_count": 8418
    },
    {
        "adult": false,
        "backdrop_path": "/ciM5RFsBoWEj0tbwJy42Hr76iRd.jpg",
        "genre_ids": [
            10751,
            12,
            16,
            35,
            14
        ],
        "id": 10501,
        "original_language": "en",
        "original_title": "The Road to El Dorado",
        "overview": "After a failed swindle, two con-men end up with a map to El Dorado, the fabled \"city of gold,\" and an unintended trip to the New World.  Much to their surprise, the map does lead the pair to the mythical city, where the startled inhabitants promptly begin to worship them as gods.  The only question is, do they take the worshipful natives for all they're worth, or is there a bit more to El Dorado than riches?",
        "popularity": 52.969,
        "poster_path": "/ryXm7xp4aqQyda0FU2eMfHehPBg.jpg",
        "release_date": "2000-03-31",
        "title": "The Road to El Dorado",
        "video": false,
        "vote_average": 7.2,
        "vote_count": 3504
    },
    {
        "adult": false,
        "backdrop_path": "/8qLen3NLCVSu1I9aqGWbTUIoBLQ.jpg",
        "genre_ids": [
            35
        ],
        "id": 2123,
        "original_language": "en",
        "original_title": "Me, Myself & Irene",
        "overview": "Rhode Island State Trooper Charlie Baileygates has a multiple personality disorder. One personality is crazy and aggressive, while the other is more friendly and laid back. Both of these personalities fall in love with the same woman named Irene after Charlie loses his medication.",
        "popularity": 47.362,
        "poster_path": "/rvRrcbLbpn7UJGRH1JupgHOeJFq.jpg",
        "release_date": "2000-06-22",
        "title": "Me, Myself & Irene",
        "video": false,
        "vote_average": 6.6,
        "vote_count": 3543
    },
    {
        "adult": false,
        "backdrop_path": "/l9PIBKLQGxBhnDPD191LLrhbQMz.jpg",
        "genre_ids": [
            16,
            10751,
            14
        ],
        "id": 5833,
        "original_language": "en",
        "original_title": "Casper's Haunted Christmas",
        "overview": "Kibosh, supreme ruler of all ghosts, decrees that casper must scare at least one person before Christmas Day so Casper visits Kriss, Massachusetts where he meets the Jollimore family and sets out to complete his mission. As usual, kindhearted Casper has a ghastky time trying to scare anyone; so The Ghostly Trio, fed up with his goody-boo-shoes behavior, secretly hires Casper's look-alike cousin Spooky to do the job-with hilarious results.",
        "popularity": 61.926,
        "poster_path": "/3BFR30kh0O3NKR1Sfea3HXCG6hw.jpg",
        "release_date": "2000-10-31",
        "title": "Casper's Haunted Christmas",
        "video": false,
        "vote_average": 5.3,
        "vote_count": 168
    },
    {
        "adult": false,
        "backdrop_path": "/2OQ3YEx5F47gsdMtrXEZdSiTZbz.jpg",
        "genre_ids": [
            80,
            18,
            10749,
            53
        ],
        "id": 3134,
        "original_language": "fr",
        "original_title": "Baise-moi",
        "overview": "Manu has lived a difficult life. Abused and violently raped, she sets off to find herself only to meet Nadine, a prostitute who has encountered one too many injustices in the world. Angry at the world, they embark on a twisted, rage-filled road trip. They choose to have sex when they please and kill when they need. Leaving a trail of mischief and dead bodies in their wake. Generating a media blitz and manhunt, soon everyone is out to capture the young fugitives.",
        "popularity": 47.781,
        "poster_path": "/fYijiVwEyP2JsDuSenGOsFNXEbn.jpg",
        "release_date": "2000-06-28",
        "title": "Baise-moi",
        "video": false,
        "vote_average": 4.8,
        "vote_count": 395
    },
    {
        "adult": false,
        "backdrop_path": "/tBOLfpP25TgqnWvhvsWocEXOoYS.jpg",
        "genre_ids": [
            35,
            80,
            28
        ],
        "id": 1493,
        "original_language": "en",
        "original_title": "Miss Congeniality",
        "overview": "When the local FBI office receives a letter from a terrorist known only as 'The Citizen', it's quickly determined that he's planning his next act at the Miss America beauty pageant. Because tough-as-nails Gracie Hart is the only female Agent at the office, she's chosen to go undercover as the contestant from New Jersey.",
        "popularity": 37.193,
        "poster_path": "/q1m9ME0zvncnFDmKXC43RqZr8mU.jpg",
        "release_date": "2000-12-22",
        "title": "Miss Congeniality",
        "video": false,
        "vote_average": 6.5,
        "vote_count": 3618
    }
];

let movieGenreEl = document.querySelectorAll('#dropdown-m .movieslist li');
let showGenreEl = document.querySelectorAll('#dropdown-m .movieslist li');
let showTitles = document.getElementById('showtitles');
let movieTitles = document.getElementById('movietitles');

let movieBtn = document.querySelector("#movies");
let showBtn = document.querySelector("#shows");
let genreBtn = document.querySelector("#genres");

// gets list of 20 movie with given genre
let genreMovies;
function getMovieByGenre(genre) {
    let pageNum = Math.floor(Math.random() * 500);
    let reqUrl = 'https://api.themoviedb.org/3/discover/movie?include_adult=false&include_video=false&language=en-US&page=' + pageNum + '&sort_by=popularity.desc&with_genres=' + genre;
    let options = {
        method: 'GET',
        headers: {
            accept: 'application/json',
            Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIzMmIxNjJjYjdhNzJiMTQ3YzMwZWJkNGQ1ZTMwZjk5NCIsInN1YiI6IjY1NjU1OWJlYThiMmNhMDBjOTg2MDMyOSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.ZTs5QJnobmaJOzvPBH6vTdoLBBmBF9gcsN_8fyRzYWk'
        }
    }

    fetch(reqUrl, options)
    .then(function (response) {
        return response.json();
    })
    .then(function (data) {
        genreMovies = data;
    // console.log(genreMovies);
        displayMovieList();
    })
    
}

// displays list of 20 movie names
let movieId;
function displayMovieList() {
    movieTitles.innerHTML = '';
    movieTitles.setAttribute('class','scroll')
    console.log(genreMovies);
    for (let i = 0;i < genreMovies.results.length; i++) {
        let hr = document.createElement('hr');
        let randMovieEl = document.createElement('li');
        let movieLink = document.createElement('button');
        let currentMovieId = genreMovies.results[i].id;
        console.log(currentMovieId);
        movieLink.textContent = genreMovies.results[i].title;

        // sets styling for the movie buttons 
        randMovieEl.setAttribute('class','p-1 block');
        movieLink.setAttribute('class','px-4 py-2 text-gray-900 rounded-s-lg text-left');
        movieLink.setAttribute('style', 'color: white; transition: color 0.3s;');

        movieLink.addEventListener('mouseover',function(){
            movieLink.style.color = 'red';
        });
        movieLink.addEventListener('mouseout', function(){
            movieLink.style.color = 'white';
        })

        movieLink.addEventListener('click', function(){
           getMovieById(currentMovieId);
        })

        console.log('movieTitles', movieLink.textContent);
        randMovieEl.append(movieLink,hr);
        movieTitles.append(randMovieEl);
    }

}

// gets the movie selected by id
let movieDetails;
function getMovieById(movieId) { 
    let reqUrl = 'https://api.themoviedb.org/3/movie/'+ movieId +'?language=en-US';
    const options = {
        method: 'GET',
        headers: {
          accept: 'application/json',
          Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIzMmIxNjJjYjdhNzJiMTQ3YzMwZWJkNGQ1ZTMwZjk5NCIsInN1YiI6IjY1NjU1OWJlYThiMmNhMDBjOTg2MDMyOSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.ZTs5QJnobmaJOzvPBH6vTdoLBBmBF9gcsN_8fyRzYWk'
        }
      };
      
    fetch(reqUrl, options)
    .then(function(response) {
        return response.json();
    })
    .then(function(data) {
        movieDetails = data;
        saveMovieDetails(movieDetails);
    })
    .then(function() {
        window.location.href = './display.html';
    })

}

// saves the data to local storage
function saveMovieDetails() {
    localStorage.setItem('Selected Movie', JSON.stringify(movieDetails));
}

// gets list of 20 show with given genre
let genreShows;
function getShowByGenre(genre) {
    
    let pageNum = Math.floor(Math.random() * 500);
    let reqUrl = 'https://api.themoviedb.org/3/discover/tv?include_adult=false&include_null_first_air_dates=false&language=en-US&page='+ pageNum +'&sort_by=popularity.desc&with_genres='+ genre;
    const options = {
        method: 'GET',
        headers: {
          accept: 'application/json',
          Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIzMmIxNjJjYjdhNzJiMTQ3YzMwZWJkNGQ1ZTMwZjk5NCIsInN1YiI6IjY1NjU1OWJlYThiMmNhMDBjOTg2MDMyOSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.ZTs5QJnobmaJOzvPBH6vTdoLBBmBF9gcsN_8fyRzYWk'
        }
      };
      
      fetch(reqUrl, options)
        .then(function(response) {
            return response.json();
        })
        .then(function(data) {
            genreShows = data;
            console.log(genreShows);
        })
        .then(displayShowList);
}

// displays list of 20 show names
function displayShowList() {
    showTitles.innerHTML = '';
    showTitles.setAttribute('class','scroll');
    
    for (let i = 0; i < genreShows.results.length; i++) {
        let hr = document.createElement('hr');
        let randShowEl = document.createElement('li');
        let showLink = document.createElement('button');
        let currentShowId = genreShows.results[i].id;
        // sets styling for show buttons
        showLink.setAttribute('class','px-4 py-2 text-gray-900 rounded-s-lg text-left')
        randShowEl.setAttribute('class','p-1 block');
        showLink.setAttribute('style', 'color: white; transition: color 0.3s;');
        showLink.textContent = genreShows.results[i].name;

        showLink.addEventListener('mouseover',function(){
            showLink.style.color = 'red';
        });
        showLink.addEventListener('mouseout', function(){
            showLink.style.color = 'white';
        });

        showLink.addEventListener('click', function(){
            getShowById(currentShowId);
        })
        // console.log('showTitles', showLink.textContent);
        randShowEl.append(showLink,hr);
        showTitles.append(randShowEl);

    }

}

// gets show selected by its id
let showDetails;
function getShowById(showId) {
    let reqUrl = 'https://api.themoviedb.org/3/tv/'+ showId +'?language=en-US';
    const options = {
        method: 'GET',
        headers: {
          accept: 'application/json',
          Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIzMmIxNjJjYjdhNzJiMTQ3YzMwZWJkNGQ1ZTMwZjk5NCIsInN1YiI6IjY1NjU1OWJlYThiMmNhMDBjOTg2MDMyOSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.ZTs5QJnobmaJOzvPBH6vTdoLBBmBF9gcsN_8fyRzYWk'
        }
      };
    fetch(reqUrl, options)
    .then(function(response) {
        return response.json();
    })
    .then(function(data) {
        showDetails = data;
        saveShowDetails(showDetails);
    })
    .then(function() {
        window.location.href = './display.html';
    })
}

//saves show details to local storage
function saveShowDetails() {
    localStorage.setItem('Selected Show', JSON.stringify(showDetails));
}

// adds event listeners to the genre buttons
function genreLinks() {
    let movieGenreLinks = document.querySelectorAll('#dropdown-m .movieslist li a');
    let showGenreLinks = document.querySelectorAll('#dropdown-s .showslist li a');

    movieGenreLinks.forEach(function (link) {
        link.addEventListener('click', function (event) {
            event.preventDefault();
            let genre = link.id;
            getMovieByGenre(genre);
        })
    })

    showGenreLinks.forEach(function (link) {
        link.addEventListener('click', function (event) {
            event.preventDefault();
            let genre = link.id;
            getShowByGenre(genre);
        })
    })
};
genreLinks();